
# Write-Up Stack-Zero

### The following code is given:


```C
 * phoenix/stack-zero, by https://exploit.education
 *
 * The aim is to change the contents of the changeme variable.
 *
 * Scientists have recently discovered a previously unknown species of
 * kangaroos, approximately in the middle of Western Australia. These
 * kangaroos are remarkable, as their insanely powerful hind legs give them
 * the ability to jump higher than a one story house (which is approximately
 * 15 feet, or 4.5 metres), simply because houses can't can't jump.
 */

#include <stdio.h>
#include <stdlib.h>
#include <string.h>
#include <unistd.h>

#define BANNER \
  "Welcome to " LEVELNAME ", brought to you by https://exploit.education"

char *gets(char *);

int main(int argc, char **argv) {
  struct {
    char buffer[64];
    volatile int changeme;
  } locals;

  printf("%s\n", BANNER);

  locals.changeme = 0;
  gets(locals.buffer);

  if (locals.changeme != 0) {
    puts("Well done, the 'changeme' variable has been changed!");
  } else {
    puts(
        "Uh oh, 'changeme' has not yet been changed. Would you like to try "
        "again?");
  }

  exit(0);
}
```
## Solve

As we can see, for solving this problem we need to change the variable
```C
locals.changeme
```
for a value different than 0 as highlighted by this piece of code:
```C
  if (locals.changeme != 0) {
    puts("Well done, the 'changeme' variable has been changed!");
  }
```
But, in the code, there is no direct input command for changing the variable. 
Even so, we can make use of

```C
gets(locals.buffer);
```

The use of gets function can lead to a vulnerability called BufferOverFlow,
where if not given a limit for user´s input, we can indefinitely write on memory, corrupting
values of variables and registers that are on the stack.

Using a debbuger like Ghidra to look at the main function we can see where on the stack-frame the **locals.changeme** variable is located
  <p align="center">
  <img src="https://github.com/Mistersz/Write-Ups/assets/82767252/778faf6a-f365-44e5-932a-54175dc45843"/>
</p>

<p align="center">
  <img src="https://github.com/Mistersz/Write-Ups/assets/82767252/da428953-6c3b-4961-851b-3d2781db270c"/>
</p>

analyzing the images we can assume that local_58 is our 64 bytes buffer and local_18 is our locals.changeme variable.

Looking at the stack, we see a 0x40 bytes difference beetween local_58 and local_18 (which is the size of the buffer since, 0x40 == 64).
So, what we need to do is fill these 0x40 bytes difference with random data, and then input more data to change the value of locals.changeme, which will 
have it´s value changed via bufferOverflow.

For this we can craft a little exploit with pwntools:


<p align="center">
  <img src="https://github.com/Mistersz/Write-Ups/assets/82767252/568e07b5-a2d0-48f0-880a-07387e0a1a21"/>
</p>

The code basically inputs 64 0´s and then change the locals.changeme variable value to 1.
Executing the code we will have:

<p align="center">
  <img src="https://github.com/Mistersz/Write-Ups/assets/82767252/ecf7a943-da20-467d-b1f3-1b4303786d9e"/>
</p>
